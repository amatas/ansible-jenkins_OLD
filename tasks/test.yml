---

- name: Login cli
  command: "java -jar /opt/jenkins/jenkins-cli.jar -s http://localhost:8080 login --username {{ jenkins_admins[0] }} --password {{ jenkins_initial_password }}"
 
- name: Get list of currently installed plugins
  shell: "java -jar {{ jenkins_cli_jar }} -s http://localhost:{{ jenkins_port }}/ list-plugins | awk '{ print $1 }'"
  register: plugin_list
 
- name: Check if plugin list is retrieved
  fail: msg="Could not retrieve plugin list"
  when: (plugin_list.stderr is defined) and (plugin_list.stderr != "")

